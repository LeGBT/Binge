require "rake/clean"

def options
	#" -g -Xlint:-serial,unchecked,deprecation"
	" -g -Xlint:all"
end

def prfx
	"fr/legbt/binge"
end


desc "defaut task"
task :default => ["modified"] 
desc "build EVERYTHING"
task :all => ["classes", "doc","ex"]

def build(file)
	puts file
	verbose(false) do
		sh %{javac #{options} #{file}}
	end
end

SRC = FileList['**/*.java']
OBJ = SRC.ext('class')

rule '.class' => '.java' do |t|
	#puts t.source
	build(t.source)
end

task :binge => ["#{prfx}/Binge.class"]
task :examples => ["examples/bouncing_balls/BouncingGame.class"]


desc "defaut task"
task :default => :modified 
task :doc => ["build_docs"] do
	verbose(false){sh %{open index.html}}
end

desc "build modified files"
task :modified do
	verbose(true){
		`git status --porcelain | grep -E -o "[^\ ]*java$"`.each_line{|line|  
	rm line.gsub(/\.java\Z/, ".class")
	}
	:binge
	:examples
	}
end


desc "rebuild everything"
task :rebuild => :clean do
	:binge
	:examples
end

desc "Docs generation..."
task :doc  do
	#	puts "Docs generation..."
	verbose(false){	sh %{javadoc fr.legbt.binge -subpackages fr.legbt.binge.items:fr.legbt.binge.timers:fr.legbt.binge.data:fr.legbt.binge.graphics:fr.legbt.binge.ui > doclog.tmp}}
end

CLEAN.include(".DS_Store","*.tmp","**/*.class")
CLOBBER.include("**/*.css", "**/*.html")
